---
name: skill-optimizer
description: 当识别到用户纠正或质疑skill结果时，自动基于上下文分析优化有异议的skill。此skill用于分析对话历史以识别用户对skill性能的反馈并生成改进建议。
license: MIT
---

# Skill 优化器

此skill检测用户对skill结果的纠正或质疑，并基于上下文分析生成优化版本的skill。

## 目的

通过分析对话历史中的用户反馈和纠正，自动改进skill。将用户的不满转化为可执行的skill改进。

## 何时使用

在以下情况下使用此skill：

1. 用户明确纠正skill的输出（例如："不对，那是错的"、"其实我的意思是..."）
2. 用户对skill结果表达不满（例如："这不匹配我的要求"）
3. 用户提供与skill行为相矛盾的替代指令或偏好
4. 分析对话模式以识别特定skill的重复问题

## 检测标准

通过在对话中查找以下模式来识别用户纠正：

### 明确纠正信号
- 否定短语："不"、"错了"、"不正确"、"这不是我想要的"
- 纠正标记："其实"、"等等"、"让我澄清一下"、"我意思是"
- 直接反馈："这不正确"、"你误解了"、"那不对"

### 隐含纠正信号
- 用户在skill执行后重新表述请求
- 用户在看到结果后提供额外约束
- 用户要求用不同参数"再试一次"
- 用户建议替代方法

## 优化流程

### 第一步：分析纠正

当检测到用户纠正时：

1. **识别有异议的skill** - 定位哪个skill产生了有争议的输出
2. **提取用户反馈** - 捕获纠正的确切性质
3. **理解差距** - 确定skill遗漏或误解了什么
4. **情境化** - 审查导致纠正的对话以获取额外上下文

### 第二步：分析原始skill

阅读原始skill的SKILL.md和任何捆绑资源以理解：

1. **当前指令** - skill目前告诉Claude做什么
2. **缺失的约束** - 用户的纠正揭示了哪些缺失的指导
3. **歧义** - skill的指令在哪里不清楚或不完整
4. **工作流差距** - skill未解决的步骤或考虑事项

### 第三步：生成优化版本

创建解决用户关切的改进版skill：

1. **添加缺失的约束** - 将用户反馈整合为明确指令
2. **澄清歧义** - 用更精确的语言重写不清楚的部分
3. **扩展工作流** - 添加纠正揭示的步骤或考虑事项
4. **改进示例** - 添加或修改展示正确行为的示例

### 第四步：展示优化

展示优化后的skill时：

1. **总结问题** - 简要解释用户纠正了什么
2. **突出变更** - 清楚说明修改了什么以及为什么
3. **显示差异** - 提供修改前/修改后的比较以保持清晰
4. **请求确认** - 询问优化是否解决了用户的关切

## 输出格式

**重要：优化完成后，必须输出修改摘要，让用户清楚知道做了什么变化。**

使用以下结构展示优化：

```
## 检测到的问题

[用户纠正内容的描述]

## 分析

[解释为什么原始skill产生了错误输出]

## 建议的优化

### 修改摘要
- **修改的skill：** [skill名称]
- **修改的文件：** [文件路径，如：.claude/skills/xxx/SKILL.md]
- **修改内容：** [简要描述修改了什么]

### 所做更改
- [更改1]：[原因]
- [更改2]：[原因]

### 更新后的 SKILL.md

[完整或部分更新的skill内容]

### 理由

[为什么这些更改解决了用户的纠正]
```

## 常见纠正模式

### 缺少上下文
**用户反馈：** "你没有考虑到[X]"
**优化：** 添加指令以在输入或环境中检查[X]

### 错误理解
**用户反馈：** "我的意思是[Y]，不是[X]"
**优化：** 澄清skill的解释规则或添加展示正确用法的示例

### 输出不完整
**用户反馈：** "这缺少[Z]"
**优化：** 添加步骤以在输出格式中包含[Z]

### 错误的工作流
**用户反馈：** "你应该在做[B]之前先做[A]"
**优化：** 重新排序或调整工作流步骤

### 风格/格式问题
**用户反馈：** "这个格式不对，使用[格式]"
**优化：** 更新输出格式规范和示例

## 持续改进

此skill还应：

1. **追踪重复纠正** - 注意同一个skill是否收到多次类似反馈
2. **识别模式** - 寻找不同skill中的系统性问题
3. **建议更广泛的改进** - 当多个纠正揭示根本性的skill设计问题时
4. **记录学习内容** - 考虑为常见纠正模式创建参考资料

## 工作流集成

**重要：此skill的目的是修改被纠正skill的源文件（SKILL.md），而不是重新润色或重写当前的回复。优化的是skill本身，使其在未来避免同样的问题。**

当此skill触发时：

1. 分析最近发生用户纠正的交流
2. 识别涉及的skill（检查Skill工具调用）
3. 按上述描述生成优化方案（针对skill文件的修改）
4. 展示发现并在应用更改前等待用户确认
5. 如果确认，将更改应用到skill的SKILL.md（使用Edit工具修改文件）

**不要做的事：**
- 不要重新润色当前回复
- 不要只是简单地重写答案
- 不要在输出中展示"优化后的回复"
- 要做的是修改skill的源文件，让它下次能做得更好

## 辅助脚本

`scripts/analyze_correction.py` 可用于独立的纠正分析，支持以下使用方式：

### 单条消息分析
```bash
python scripts/analyze_correction.py "不，这不是我想要的，我需要X而不是Y"
```

### 对话文件分析
```bash
python scripts/analyze_correction.py --file conversation.json
```

对话文件格式（JSON）：
```json
[
    {"role": "user", "content": "帮我翻译这段文本"},
    {"role": "assistant", "content": "..."},
    {"role": "user", "content": "不对，这样翻译太生硬了"}
]
```

### 交互式输入
```bash
python scripts/analyze_correction.py
```
然后逐行输入用户消息，空行结束。

### 输出选项
添加 `--json` 参数可获得JSON格式的结构化输出。